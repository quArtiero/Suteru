{% extends 'base.html' %}
{% block content %}
<h1>Editar Pergunta</h1>
<form method="POST" class="mx-auto" style="max-width: 600px;">
    <div class="form-group">
        <label for="question">Pergunta</label>
        <div id="question-editor"></div>
        <input type="hidden" name="question">
    </div>
    <div class="form-group">
        <label for="correct_answer">Resposta Correta</label>
        <div id="correct-answer-editor"></div>
        <input type="hidden" name="correct_answer">
    </div>
    <div class="form-group">
        <label for="option1">Opção 1</label>
        <div id="option1-editor"></div>
        <input type="hidden" name="option1">
    </div>
    <div class="form-group">
        <label for="option2">Opção 2</label>
        <div id="option2-editor"></div>
        <input type="hidden" name="option2">
    </div>
    <div class="form-group">
        <label for="option3">Opção 3</label>
        <div id="option3-editor"></div>
        <input type="hidden" name="option3">
    </div>
    <div class="form-group">
        <label for="option4">Opção 4</label>
        <div id="option4-editor"></div>
        <input type="hidden" name="option4">
    </div>
    <div class="form-group">
        <label for="points">Pontos:</label>
        <input type="number" id="points" name="points" class="form-control" value="{{ question[7] }}" required>
    </div>
    <div class="form-group">
        <label for="topic">Tópico:</label>
        <select id="topic" name="topic" class="form-control" required>
            {% for topic in topics %}
                <option value="{{ topic }}" {% if topic == question[8] %}selected{% endif %}>{{ topic }}</option>
            {% endfor %}
            <option value="novo_tema">Novo Tópico</option>
        </select>
    </div>
    <div id="new-topic" class="form-group" style="display: none;">
        <label for="new_topic">Novo Tópico:</label>
        <input type="text" id="new_topic" name="new_topic" class="form-control">
    </div>
    <div class="form-group">
        <label for="grade">Série:</label>
        <select id="grade" name="grade" class="form-control" required>
            {% for grade in grades %}
                <option value="{{ grade }}" {% if grade == question[9] %}selected{% endif %}>{{ grade }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-success btn-block mt-4">Atualizar Pergunta</button>
</form>
<script>
    document.getElementById('topic').addEventListener('change', function () {
        var newTopicField = document.getElementById('new-topic');
        if (this.value === 'novo_tema') {
            newTopicField.style.display = 'block';
        } else {
            newTopicField.style.display = 'none';
        }
    });

    const editorConfig = {
        theme: 'snow',
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline'],
                ['image', 'formula'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }]
            ]
        }
    };

    const editors = {
        question: new Quill('#question-editor', editorConfig),
        correct_answer: new Quill('#correct-answer-editor', editorConfig),
        option1: new Quill('#option1-editor', editorConfig),
        option2: new Quill('#option2-editor', editorConfig),
        option3: new Quill('#option3-editor', editorConfig),
        option4: new Quill('#option4-editor', editorConfig)
    };

    // Preencher os editores com o conteúdo existente
    editors.question.root.innerHTML = `{{ question[1] | safe }}`;
    editors.correct_answer.root.innerHTML = `{{ question[2] | safe }}`;
    editors.option1.root.innerHTML = `{{ question[3] | safe }}`;
    editors.option2.root.innerHTML = `{{ question[4] | safe }}`;
    editors.option3.root.innerHTML = `{{ question[5] | safe }}`;
    editors.option4.root.innerHTML = `{{ question[6] | safe }}`;

    document.querySelector('form').onsubmit = function() {
        for (let field in editors) {
            document.querySelector(`input[name=${field}]`).value = editors[field].root.innerHTML;
        }
    };
</script>
{% endblock %}
