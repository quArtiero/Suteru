{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
{% endblock %}

{% block content %}
<div class="auth-modern-container">
  <!-- Floating Background Elements -->
  <div class="floating-elements">
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
  </div>

  <div class="auth-card-modern">
    <!-- Auth Header -->
    <div class="auth-header">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo Šutēru" class="auth-logo">
      <h1 class="auth-title">Junte-se ao Šutēru!</h1>
      <p class="auth-subtitle">Crie sua conta e comece a transformar conhecimento em impacto social</p>
    </div>

    <!-- Registration Form -->
    <form method="POST" class="form-modern" id="registerForm" novalidate>
      
      <!-- Username Field -->
      <div class="form-group">
        <label for="username" class="form-label">
          <i class="fas fa-user me-2"></i>Nome de Usuário
        </label>
        <div class="input-group">
          <i class="input-icon fas fa-user"></i>
          {{ form.username(class="form-control", placeholder="Escolha um nome único", id="username") }}
        </div>
        {% if form.username.errors %}
          <div class="invalid-feedback">{{ form.username.errors[0] }}</div>
        {% endif %}
      </div>

      <!-- Email Field -->
      <div class="form-group">
        <label for="email" class="form-label">
          <i class="fas fa-envelope me-2"></i>Email
        </label>
        <div class="input-group">
          <i class="input-icon fas fa-envelope"></i>
          {{ form.email(class="form-control", placeholder="Seu melhor email", id="email") }}
        </div>
        {% if form.email.errors %}
          <div class="invalid-feedback">{{ form.email.errors[0] }}</div>
        {% endif %}
      </div>

      <!-- Password Field -->
      <div class="form-group">
        <label for="password" class="form-label">
          <i class="fas fa-lock me-2"></i>Senha
        </label>
        <div class="input-group">
          <i class="input-icon fas fa-lock"></i>
          {{ form.password(class="form-control", placeholder="Crie uma senha forte", id="password") }}
        </div>
        {% if form.password.errors %}
          <div class="invalid-feedback">{{ form.password.errors[0] }}</div>
        {% endif %}
      </div>

      <!-- Confirm Password Field -->
      <div class="form-group">
        <label for="confirm_password" class="form-label">
          <i class="fas fa-check-circle me-2"></i>Confirmar Senha
        </label>
        <div class="input-group">
          <i class="input-icon fas fa-check-circle"></i>
          {{ form.confirm_password(class="form-control", placeholder="Digite a senha novamente", id="confirm_password") }}
        </div>
        {% if form.confirm_password.errors %}
          <div class="invalid-feedback">{{ form.confirm_password.errors[0] }}</div>
        {% endif %}
      </div>

      <!-- Terms Checkbox -->
      <div class="form-check" style="margin: var(--space-4) 0;">
        {{ form.accept_terms(class="form-check-input", id="accept_terms") }}
        <label class="form-check-label" for="accept_terms">
          Aceito os <a href="#" class="auth-link">termos de uso</a> e a <a href="#" class="auth-link">política de privacidade</a>
        </label>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="auth-btn auth-btn-primary" id="submitBtn">
        <i class="fas fa-user-plus me-2"></i>
        <span id="submitText">Criar Conta</span>
        <div class="auth-loading" id="loadingSpinner" style="display: none;">
          <div class="auth-spinner"></div>
          <span>Criando conta...</span>
        </div>
      </button>

      <!-- Alternative Action -->
      <a href="{{ url_for('quiz.quizzes') }}" class="auth-btn auth-btn-secondary">
        <i class="fas fa-eye me-2"></i>Ver Quizzes Públicos
      </a>
    </form>

    <!-- Links Section -->
    <div class="auth-links">
      <p>Já tem uma conta?</p>
      <a href="{{ url_for('auth.login') }}" class="auth-link">
        <i class="fas fa-sign-in-alt me-2"></i>Fazer login
      </a>
    </div>
  </div>
</div>

<script>
// Registration form enhancements
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registerForm');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const loadingSpinner = document.getElementById('loadingSpinner');
    
    // Form submission with loading state
    form.addEventListener('submit', function(e) {
        const isValid = validateForm();
        if (isValid) {
            submitText.style.display = 'none';
            loadingSpinner.style.display = 'flex';
            submitBtn.disabled = true;
        } else {
            e.preventDefault();
        }
    });
    
    // Real-time validation
    const usernameField = document.getElementById('username');
    const emailField = document.getElementById('email');
    const passwordField = document.getElementById('password');
    const confirmPasswordField = document.getElementById('confirm_password');
    const termsCheckbox = document.getElementById('accept_terms');
    
    usernameField.addEventListener('blur', function() {
        validateUsername(this);
    });
    
    emailField.addEventListener('blur', function() {
        validateEmail(this);
    });
    
    passwordField.addEventListener('blur', function() {
        validatePassword(this);
    });
    
    confirmPasswordField.addEventListener('blur', function() {
        validateConfirmPassword(this);
    });
    
    function validateUsername(field) {
        if (field.value && field.value.length < 3) {
            field.classList.add('is-invalid');
            field.classList.remove('is-valid');
            return false;
        } else if (field.value) {
            field.classList.add('is-valid');
            field.classList.remove('is-invalid');
            return true;
        }
        return false;
    }
    
    function validateEmail(field) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (field.value && !emailRegex.test(field.value)) {
            field.classList.add('is-invalid');
            field.classList.remove('is-valid');
            return false;
        } else if (field.value) {
            field.classList.add('is-valid');
            field.classList.remove('is-invalid');
            return true;
        }
        return false;
    }
    
    function validatePassword(field) {
        if (field.value && field.value.length < 6) {
            field.classList.add('is-invalid');
            field.classList.remove('is-valid');
            return false;
        } else if (field.value) {
            field.classList.add('is-valid');
            field.classList.remove('is-invalid');
            return true;
        }
        return false;
    }
    
    function validateConfirmPassword(field) {
        if (field.value && field.value !== passwordField.value) {
            field.classList.add('is-invalid');
            field.classList.remove('is-valid');
            return false;
        } else if (field.value && field.value === passwordField.value) {
            field.classList.add('is-valid');
            field.classList.remove('is-invalid');
            return true;
        }
        return false;
    }
    
    function validateForm() {
        const usernameValid = validateUsername(usernameField);
        const emailValid = validateEmail(emailField);
        const passwordValid = validatePassword(passwordField);
        const confirmPasswordValid = validateConfirmPassword(confirmPasswordField);
        const termsAccepted = termsCheckbox.checked;
        
        if (!termsAccepted) {
            alert('Você deve aceitar os termos de uso para continuar.');
            return false;
        }
        
        return usernameValid && emailValid && passwordValid && confirmPasswordValid && termsAccepted;
    }
});
</script>
{% endblock %}
